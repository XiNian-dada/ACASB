<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACASB - å¤ä»£å»ºç­‘é£æ ¼è¯†åˆ«ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        #app {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            padding: 30px;
            margin-bottom: 20px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
            font-size: 28px;
        }
        
        h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 22px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            margin-right: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .btn-info {
            background: #17a2b8;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #333;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        input[type="text"],
        input[type="number"],
        input[type="file"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .filter-bar {
            display: flex;
            gap: 15px;
            align-items: flex-end;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-bar .form-group {
            flex: 1;
            min-width: 200px;
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .results-table th,
        .results-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }
        
        .results-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 13px;
        }
        
        .results-table tr:hover {
            background: #f8f9fa;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge-royal {
            background: #ffc107;
            color: #333;
        }
        
        .badge-civilian {
            background: #17a2b8;
            color: white;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 18px;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        
        .info {
            background: #d1ecf1;
            color: #0c5460;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-card h3 {
            font-size: 14px;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        
        .stat-card .value {
            font-size: 32px;
            font-weight: 700;
        }
        
        .file-list {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .file-item:last-child {
            border-bottom: none;
        }
        
        .file-item .name {
            flex: 1;
        }
        
        .file-item .status {
            font-weight: 600;
        }
        
        .file-item .success {
            color: #28a745;
        }
        
        .file-item .error {
            color: #dc3545;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .loading-overlay .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .api-test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .api-test-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .api-test-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }
        
        .api-test-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .api-test-card .endpoint {
            background: #e9ecef;
            padding: 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin-bottom: 15px;
            word-break: break-all;
        }
        
        .api-test-card .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .api-test-card .status.success {
            background: #d4edda;
            color: #155724;
        }
        
        .api-test-card .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .api-test-card .status.pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .result-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .result-box pre {
            margin: 0;
            font-size: 12px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="spinner"></div>
    </div>
    
    <div id="app">
        <div class="container">
            <h1>ğŸ›ï¸ ACASB - å¤ä»£å»ºç­‘é£æ ¼è¯†åˆ«ç³»ç»Ÿ</h1>
            
            <div id="error-message" class="error" style="display: none;"></div>
            <div id="success-message" class="success" style="display: none;"></div>
            <div id="info-message" class="info" style="display: none;"></div>
            
            <div class="stats">
                <div class="stat-card">
                    <h3>æ€»è®°å½•æ•°</h3>
                    <div class="value" id="total-count">0</div>
                </div>
                <div class="stat-card">
                    <h3>çš‡å®¤å»ºç­‘</h3>
                    <div class="value" id="royal-count">0</div>
                </div>
                <div class="stat-card">
                    <h3>å¹³æ°‘å»ºç­‘</h3>
                    <div class="value" id="civilian-count">0</div>
                </div>
                <div class="stat-card">
                    <h3>é¢„æµ‹å‡†ç¡®ç‡</h3>
                    <div class="value" id="accuracy">0%</div>
                </div>
            </div>
            
            <div class="section">
                <h2>ğŸ“¤ æ‰¹é‡ä¸Šä¼ å›¾ç‰‡</h2>
                
                <div 
                    id="upload-area"
                    class="api-test-card"
                    style="border-style: dashed; cursor: pointer;"
                >
                    <input 
                        type="file" 
                        id="file-input" 
                        multiple 
                        accept="image/*" 
                        style="display: none;"
                    >
                    <div id="upload-prompt">
                        <p style="font-size: 18px; color: #667eea;">ğŸ“ ç‚¹å‡»æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„</p>
                        <p style="color: #6c757d; margin-top: 10px;">æ”¯æŒ JPGã€PNG æ ¼å¼</p>
                    </div>
                </div>
                
                <div id="file-list" class="file-list" style="display: none;"></div>
                
                <div style="margin-top: 20px;">
                    <button class="btn" id="upload-btn" disabled>å¼€å§‹ä¸Šä¼ </button>
                    <button class="btn btn-secondary" id="clear-btn" disabled>æ¸…ç©º</button>
                </div>
            </div>
            
            <div class="section">
                <h2>ğŸ” æ•°æ®æŸ¥è¯¢ä¸æ’åº</h2>
                
                <div class="filter-bar">
                    <div class="form-group">
                        <label>æ’åºå­—æ®µ</label>
                        <select id="field-select">
                            <option value="royalRatio">çš‡å®¶æ¯”ä¾‹</option>
                            <option value="entropy">ç†µå€¼</option>
                            <option value="edgeDensity">è¾¹ç¼˜å¯†åº¦</option>
                            <option value="contrast">å¯¹æ¯”åº¦</option>
                            <option value="dissimilarity">ä¸ç›¸ä¼¼åº¦</option>
                            <option value="homogeneity">åŒè´¨æ€§</option>
                            <option value="asm">è§’äºŒé˜¶çŸ©</option>
                            <option value="hMean">è‰²ç›¸å‡å€¼</option>
                            <option value="hStd">è‰²ç›¸æ ‡å‡†å·®</option>
                            <option value="sMean">é¥±å’Œåº¦å‡å€¼</option>
                            <option value="sStd">é¥±å’Œåº¦æ ‡å‡†å·®</option>
                            <option value="vMean">æ˜åº¦å‡å€¼</option>
                            <option value="vStd">æ˜åº¦æ ‡å‡†å·®</option>
                            <option value="ratioYellow">é»„è‰²æ¯”ä¾‹</option>
                            <option value="ratioRed1">çº¢è‰²1æ¯”ä¾‹</option>
                            <option value="ratioRed2">çº¢è‰²2æ¯”ä¾‹</option>
                            <option value="ratioBlue">è“è‰²æ¯”ä¾‹</option>
                            <option value="ratioGreen">ç»¿è‰²æ¯”ä¾‹</option>
                            <option value="ratioGrayWhite">ç°ç™½è‰²æ¯”ä¾‹</option>
                            <option value="ratioBlack">é»‘è‰²æ¯”ä¾‹</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>æ’åºæ–¹å¼</label>
                        <select id="order-select">
                            <option value="desc">é™åº</option>
                            <option value="asc">å‡åº</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>è¿”å›æ•°é‡</label>
                        <input type="number" id="limit-input" value="10" min="1" max="100">
                    </div>
                    
                    <div class="form-group">
                        <label>å»ºç­‘ç±»å‹</label>
                        <select id="prediction-select">
                            <option value="">å…¨éƒ¨</option>
                            <option value="royal">çš‡å®¤å»ºç­‘</option>
                            <option value="civilian">å¹³æ°‘å»ºç­‘</option>
                        </select>
                    </div>
                    
                    <div class="form-group" style="flex: 0;">
                        <label>&nbsp;</label>
                        <button class="btn btn-success" id="query-btn">æŸ¥è¯¢</button>
                    </div>
                </div>
            </div>
            
            <div id="loading" class="loading" style="display: none;">
                â³ åŠ è½½ä¸­...
            </div>
            
            <div id="results-container" style="display: none;">
                <table class="results-table">
                    <thead>
                        <tr id="results-header">
                        </tr>
                    </thead>
                    <tbody id="results-body">
                    </tbody>
                </table>
            </div>
            
            <div class="section">
                <h2>ğŸ§ª API æ¥å£æµ‹è¯•</h2>
                
                <div class="api-test-grid">
                    <div class="api-test-card" id="test-predict">
                        <h3>1. å›¾åƒé¢„æµ‹æ¥å£</h3>
                        <div class="endpoint">POST /api/predict</div>
                        <div class="form-group">
                            <label>å›¾ç‰‡è·¯å¾„</label>
                            <input type="text" id="predict-path" placeholder="E:\Code\ACASB\1.jpg">
                        </div>
                        <button class="btn btn-info" onclick="testPredict()">æµ‹è¯•</button>
                        <div class="status pending" id="predict-status">æœªæµ‹è¯•</div>
                        <div class="result-box" id="predict-result" style="display: none;"></div>
                    </div>
                    
                    <div class="api-test-card" id="test-analyze">
                        <h3>2. å›¾åƒåˆ†ææ¥å£</h3>
                        <div class="endpoint">POST /api/analyze</div>
                        <div class="form-group">
                            <label>é€‰æ‹©å›¾ç‰‡æ–‡ä»¶ï¼ˆæ¨èï¼‰</label>
                            <input type="file" id="analyze-file" accept="image/*">
                        </div>
                        <div class="form-group">
                            <label>æˆ–è¾“å…¥å›¾ç‰‡è·¯å¾„</label>
                            <input type="text" id="analyze-path" placeholder="E:\Code\ACASB\1.jpg">
                        </div>
                        <button class="btn btn-info" onclick="testAnalyze()">æµ‹è¯•</button>
                        <div class="status pending" id="analyze-status">æœªæµ‹è¯•</div>
                        <div class="result-box" id="analyze-result" style="display: none;"></div>
                    </div>
                    
                    <div class="api-test-card" id="test-upload">
                        <h3>3. æ•°æ®ä¸Šä¼ æ¥å£</h3>
                        <div class="endpoint">POST /data/add</div>
                        <div class="form-group">
                            <label>é€‰æ‹©å›¾ç‰‡</label>
                            <input type="file" id="upload-single-file" accept="image/*">
                        </div>
                        <button class="btn btn-info" onclick="testUpload()">æµ‹è¯•</button>
                        <div class="status pending" id="upload-status">æœªæµ‹è¯•</div>
                        <div class="result-box" id="upload-result" style="display: none;"></div>
                    </div>
                    
                    <div class="api-test-card" id="test-batch">
                        <h3>4. æ‰¹é‡ä¸Šä¼ æ¥å£</h3>
                        <div class="endpoint">POST /data/batch</div>
                        <div class="form-group">
                            <label>é€‰æ‹©å¤šå¼ å›¾ç‰‡</label>
                            <input type="file" id="upload-batch-files" multiple accept="image/*">
                        </div>
                        <button class="btn btn-info" onclick="testBatchUpload()">æµ‹è¯•</button>
                        <div class="status pending" id="batch-status">æœªæµ‹è¯•</div>
                        <div class="result-box" id="batch-result" style="display: none;"></div>
                    </div>
                    
                    <div class="api-test-card" id="test-query-analysis">
                        <h3>5. æŸ¥è¯¢åˆ†æä¿¡æ¯æ¥å£</h3>
                        <div class="endpoint">GET /data/analysis/{id}</div>
                        <div class="form-group">
                            <label>è®°å½• ID</label>
                            <input type="number" id="query-analysis-id" placeholder="1" value="1">
                        </div>
                        <button class="btn btn-info" onclick="testQueryAnalysis()">æµ‹è¯•</button>
                        <div class="status pending" id="query-analysis-status">æœªæµ‹è¯•</div>
                        <div class="result-box" id="query-analysis-result" style="display: none;"></div>
                    </div>
                    
                    <div class="api-test-card" id="test-query-type">
                        <h3>6. æŸ¥è¯¢å»ºç­‘ç±»å‹æ¥å£</h3>
                        <div class="endpoint">GET /data/type/{id}</div>
                        <div class="form-group">
                            <label>è®°å½• ID</label>
                            <input type="number" id="query-type-id" placeholder="1" value="1">
                        </div>
                        <button class="btn btn-info" onclick="testQueryType()">æµ‹è¯•</button>
                        <div class="status pending" id="query-type-status">æœªæµ‹è¯•</div>
                        <div class="result-box" id="query-type-result" style="display: none;"></div>
                    </div>
                    
                    <div class="api-test-card" id="test-sort">
                        <h3>7. æ•°æ®æ’åºæŸ¥è¯¢æ¥å£</h3>
                        <div class="endpoint">GET /data/list</div>
                        <div class="form-group">
                            <label>æ’åºå­—æ®µ</label>
                            <select id="sort-field">
                                <option value="royalRatio">çš‡å®¶æ¯”ä¾‹</option>
                                <option value="entropy">ç†µå€¼</option>
                                <option value="edgeDensity">è¾¹ç¼˜å¯†åº¦</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>æ’åºæ–¹å¼</label>
                            <select id="sort-order">
                                <option value="desc">é™åº</option>
                                <option value="asc">å‡åº</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>è¿”å›æ•°é‡</label>
                            <input type="number" id="sort-limit" value="5">
                        </div>
                        <button class="btn btn-info" onclick="testSort()">æµ‹è¯•</button>
                        <div class="status pending" id="sort-status">æœªæµ‹è¯•</div>
                        <div class="result-box" id="sort-result" style="display: none;"></div>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <button class="btn btn-warning" onclick="testAllApis()">ğŸš€ æµ‹è¯•æ‰€æœ‰æ¥å£</button>
                    <button class="btn btn-secondary" onclick="clearAllResults()">ğŸ—‘ï¸ æ¸…ç©ºç»“æœ</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        var uploadFiles = [];
        var results = [];
        var apiBaseUrl = 'http://localhost:8080';
        
        function showLoading(show) {
            document.getElementById('loading-overlay').style.display = show ? 'flex' : 'none';
        }
        
        function showError(message) {
            var errorDiv = document.getElementById('error-message');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(function() {
                errorDiv.style.display = 'none';
            }, 5000);
        }
        
        function showSuccess(message) {
            var successDiv = document.getElementById('success-message');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            setTimeout(function() {
                successDiv.style.display = 'none';
            }, 5000);
        }
        
        function showInfo(message) {
            var infoDiv = document.getElementById('info-message');
            infoDiv.textContent = message;
            infoDiv.style.display = 'block';
            setTimeout(function() {
                infoDiv.style.display = 'none';
            }, 5000);
        }
        
        function updateStatus(elementId, status, text) {
            var element = document.getElementById(elementId);
            element.className = 'status ' + status;
            element.textContent = text;
        }
        
        function showResult(elementId, data) {
            var element = document.getElementById(elementId);
            element.style.display = 'block';
            element.innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
        }
        
        function updateStats() {
            var totalCount = results.length;
            var royalCount = results.filter(function(item) {
                return item.prediction === 'royal';
            }).length;
            var civilianCount = results.filter(function(item) {
                return item.prediction === 'civilian';
            }).length;
            var accuracy = totalCount > 0 ? ((royalCount + civilianCount) / totalCount * 100).toFixed(2) : 0;
            
            document.getElementById('total-count').textContent = totalCount;
            document.getElementById('royal-count').textContent = royalCount;
            document.getElementById('civilian-count').textContent = civilianCount;
            document.getElementById('accuracy').textContent = accuracy + '%';
        }
        
        function renderResults() {
            var tbody = document.getElementById('results-body');
            var thead = document.getElementById('results-header');
            tbody.innerHTML = '';
            thead.innerHTML = '';
            
            if (results.length === 0) {
                document.getElementById('results-container').style.display = 'none';
                return;
            }
            
            var field = document.getElementById('field-select').value;
            
            var fieldLabels = {
                'royalRatio': 'çš‡å®¶æ¯”ä¾‹',
                'entropy': 'ç†µå€¼',
                'edgeDensity': 'è¾¹ç¼˜å¯†åº¦',
                'contrast': 'å¯¹æ¯”åº¦',
                'dissimilarity': 'ä¸ç›¸ä¼¼åº¦',
                'homogeneity': 'åŒè´¨æ€§',
                'asm': 'è§’äºŒé˜¶çŸ©',
                'hMean': 'è‰²ç›¸å‡å€¼',
                'hStd': 'è‰²ç›¸æ ‡å‡†å·®',
                'sMean': 'é¥±å’Œåº¦å‡å€¼',
                'sStd': 'é¥±å’Œåº¦æ ‡å‡†å·®',
                'vMean': 'æ˜åº¦å‡å€¼',
                'vStd': 'æ˜åº¦æ ‡å‡†å·®',
                'ratioYellow': 'é»„è‰²æ¯”ä¾‹',
                'ratioRed1': 'çº¢è‰²1æ¯”ä¾‹',
                'ratioRed2': 'çº¢è‰²2æ¯”ä¾‹',
                'ratioBlue': 'è“è‰²æ¯”ä¾‹',
                'ratioGreen': 'ç»¿è‰²æ¯”ä¾‹',
                'ratioGrayWhite': 'ç°ç™½è‰²æ¯”ä¾‹',
                'ratioBlack': 'é»‘è‰²æ¯”ä¾‹'
            };
            
            var fieldKeys = ['id', 'imagePath', 'prediction', 'confidence', field];
            
            var headerHtml = '<tr>';
            fieldKeys.forEach(function(key) {
                var label = key;
                if (key === 'id') label = 'ID';
                else if (key === 'imagePath') label = 'å›¾ç‰‡è·¯å¾„';
                else if (key === 'prediction') label = 'é¢„æµ‹ç»“æœ';
                else if (key === 'confidence') label = 'ç½®ä¿¡åº¦';
                else if (fieldLabels[key]) label = fieldLabels[key];
                
                headerHtml += '<th>' + label + '</th>';
            });
            headerHtml += '</tr>';
            thead.innerHTML = headerHtml;
            
            results.forEach(function(item) {
                var tr = document.createElement('tr');
                
                var rowHtml = '<td>' + item.id + '</td>' +
                    '<td>' + item.imagePath + '</td>' +
                    '<td><span class="badge badge-' + item.prediction + '">' + 
                        (item.prediction === 'royal' ? 'ğŸ° çš‡å®¤' : 'ğŸ  å¹³æ°‘') + 
                    '</span></td>' +
                    '<td>' + (item.confidence ? (item.confidence * 100).toFixed(2) + '%' : 'N/A') + '</td>';
                
                var fieldValue = item[field];
                if (fieldValue !== undefined && fieldValue !== null) {
                    rowHtml += '<td>' + parseFloat(fieldValue).toFixed(4) + '</td>';
                } else {
                    rowHtml += '<td>N/A</td>';
                }
                
                tr.innerHTML = rowHtml;
                tbody.appendChild(tr);
            });
            
            document.getElementById('results-container').style.display = 'block';
        }
        
        function renderFileList() {
            var fileList = document.getElementById('file-list');
            fileList.innerHTML = '';
            
            if (uploadFiles.length === 0) {
                fileList.style.display = 'none';
                return;
            }
            
            fileList.style.display = 'block';
            
            uploadFiles.forEach(function(file, index) {
                var div = document.createElement('div');
                div.className = 'file-item';
                div.innerHTML = 
                    '<span class="name">' + file.name + '</span>' +
                    '<span class="status ' + file.status + '">' + file.statusText + '</span>';
                fileList.appendChild(div);
            });
            
            document.getElementById('upload-btn').disabled = false;
            document.getElementById('clear-btn').disabled = false;
        }
        
        function uploadFiles() {
            if (uploadFiles.length === 0) return;
            
            showLoading(true);
            var formData = new FormData();
            uploadFiles.forEach(function(file) {
                formData.append('files', file.file);
            });
            
            var xhr = new XMLHttpRequest();
            xhr.open('POST', apiBaseUrl + '/data/batch', true);
            xhr.onload = function() {
                showLoading(false);
                if (xhr.status === 200) {
                    var data = JSON.parse(xhr.responseText);
                    
                    uploadFiles.forEach(function(item, index) {
                        var resultItem = data.items[index];
                        if (resultItem && resultItem.success) {
                            item.status = 'success';
                            item.statusText = 'ä¸Šä¼ æˆåŠŸ';
                        } else {
                            item.status = 'error';
                            item.statusText = resultItem ? resultItem.message : 'ä¸Šä¼ å¤±è´¥';
                        }
                    });
                    
                    renderFileList();
                    showSuccess('ä¸Šä¼ å®Œæˆï¼æˆåŠŸ ' + data.successCount + ' å¼ ï¼Œå¤±è´¥ ' + data.failureCount + ' å¼ ');
                    
                    setTimeout(fetchData, 1000);
                } else {
                    showError('ä¸Šä¼ å¤±è´¥ï¼š' + xhr.statusText);
                    uploadFiles.forEach(function(item) {
                        item.status = 'error';
                        item.statusText = 'ä¸Šä¼ å¤±è´¥';
                    });
                    renderFileList();
                }
            };
            xhr.onerror = function() {
                showLoading(false);
                showError('ä¸Šä¼ å¤±è´¥ï¼šç½‘ç»œé”™è¯¯');
                uploadFiles.forEach(function(item) {
                    item.status = 'error';
                    item.statusText = 'ä¸Šä¼ å¤±è´¥';
                });
                renderFileList();
            };
            xhr.send(formData);
        }
        
        function fetchData() {
            showLoading(true);
            
            var field = document.getElementById('field-select').value;
            var order = document.getElementById('order-select').value;
            var limit = document.getElementById('limit-input').value;
            var prediction = document.getElementById('prediction-select').value;
            
            var url = apiBaseUrl + '/data/list?field=' + encodeURIComponent(field) + 
                '&order=' + encodeURIComponent(order) + 
                '&limit=' + encodeURIComponent(limit);
            
            if (prediction) {
                url += '&prediction=' + encodeURIComponent(prediction);
            }
            
            var xhr = new XMLHttpRequest();
            xhr.open('GET', url, true);
            xhr.onload = function() {
                showLoading(false);
                try {
                    if (xhr.status === 200) {
                        var data = JSON.parse(xhr.responseText);
                        if (data.success) {
                            results = data.data || [];
                            renderResults();
                            updateStats();
                        } else {
                            showError('æŸ¥è¯¢å¤±è´¥ï¼š' + (data.message || 'æœªçŸ¥é”™è¯¯'));
                        }
                    } else {
                        showError('æŸ¥è¯¢å¤±è´¥ï¼šHTTP ' + xhr.status);
                    }
                } catch (e) {
                    showError('æŸ¥è¯¢å¤±è´¥ï¼š' + e.message);
                    console.error('è§£æå“åº”å¤±è´¥:', e);
                }
            };
            xhr.onerror = function() {
                showLoading(false);
                showError('æŸ¥è¯¢å¤±è´¥ï¼šç½‘ç»œé”™è¯¯');
            };
            xhr.ontimeout = function() {
                showLoading(false);
                showError('æŸ¥è¯¢å¤±è´¥ï¼šè¯·æ±‚è¶…æ—¶');
            };
            xhr.timeout = 30000;
            xhr.send();
        }
        
        function clearFiles() {
            uploadFiles = [];
            renderFileList();
            document.getElementById('upload-btn').disabled = true;
            document.getElementById('clear-btn').disabled = true;
        }
        
        function testPredict() {
            var imagePath = document.getElementById('predict-path').value;
            if (!imagePath) {
                showError('è¯·è¾“å…¥å›¾ç‰‡è·¯å¾„');
                return;
            }
            
            showLoading(true);
            updateStatus('predict-status', 'pending', 'æµ‹è¯•ä¸­...');
            
            var xhr = new XMLHttpRequest();
            xhr.open('POST', apiBaseUrl + '/api/predict', true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.onload = function() {
                showLoading(false);
                if (xhr.status === 200) {
                    var data = JSON.parse(xhr.responseText);
                    if (data.success) {
                        updateStatus('predict-status', 'success', 'âœ“ æˆåŠŸ');
                        showResult('predict-result', data);
                    } else {
                        updateStatus('predict-status', 'error', 'âœ— å¤±è´¥');
                        showResult('predict-result', data);
                    }
                } else {
                    updateStatus('predict-status', 'error', 'âœ— å¤±è´¥');
                    showResult('predict-result', { error: 'HTTP ' + xhr.status });
                }
            };
            xhr.onerror = function() {
                showLoading(false);
                updateStatus('predict-status', 'error', 'âœ— å¤±è´¥');
                showResult('predict-result', { error: 'ç½‘ç»œé”™è¯¯' });
            };
            xhr.send(JSON.stringify({ image_path: imagePath }));
        }
        
        function testAnalyze() {
            var fileInput = document.getElementById('analyze-file');
            var imagePath = document.getElementById('analyze-path').value;
            
            if (!fileInput.files[0] && !imagePath) {
                showError('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶æˆ–è¾“å…¥å›¾ç‰‡è·¯å¾„');
                return;
            }
            
            showLoading(true);
            updateStatus('analyze-status', 'pending', 'æµ‹è¯•ä¸­...');
            
            var xhr = new XMLHttpRequest();
            xhr.open('POST', apiBaseUrl + '/api/analyze', true);
            
            var formData = new FormData();
            
            xhr.onload = function() {
                showLoading(false);
                if (xhr.status === 200) {
                    var data = JSON.parse(xhr.responseText);
                    if (data.success) {
                        updateStatus('analyze-status', 'success', 'âœ“ æˆåŠŸ');
                        showResult('analyze-result', data);
                    } else {
                        updateStatus('analyze-status', 'error', 'âœ— å¤±è´¥');
                        showResult('analyze-result', data);
                    }
                } else {
                    updateStatus('analyze-status', 'error', 'âœ— å¤±è´¥');
                    showResult('analyze-result', { error: 'HTTP ' + xhr.status });
                }
            };
            
            xhr.onerror = function() {
                showLoading(false);
                updateStatus('analyze-status', 'error', 'âœ— å¤±è´¥');
                showResult('analyze-result', { error: 'ç½‘ç»œé”™è¯¯' });
            };
            
            if (fileInput.files[0]) {
                formData.append('file', fileInput.files[0]);
                xhr.send(formData);
            } else if (imagePath) {
                fetch(imagePath)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('HTTP ' + response.status);
                        }
                        return response.blob();
                    })
                    .then(blob => {
                        var file = new File([blob], 'image.jpg', { type: 'image/jpeg' });
                        formData.append('file', file);
                        xhr.send(formData);
                    })
                    .catch(error => {
                        showLoading(false);
                        updateStatus('analyze-status', 'error', 'âœ— å¤±è´¥');
                        showResult('analyze-result', { error: 'è¯»å–å›¾ç‰‡å¤±è´¥: ' + error.message + 'ã€‚æç¤ºï¼šè¯·ä½¿ç”¨æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½' });
                    });
            }
        }
        
        function testUpload() {
            var fileInput = document.getElementById('upload-single-file');
            var file = fileInput.files[0];
            if (!file) {
                showError('è¯·é€‰æ‹©å›¾ç‰‡');
                return;
            }
            
            showLoading(true);
            updateStatus('upload-status', 'pending', 'æµ‹è¯•ä¸­...');
            
            var formData = new FormData();
            formData.append('file', file);
            
            var xhr = new XMLHttpRequest();
            xhr.open('POST', apiBaseUrl + '/data/add', true);
            xhr.onload = function() {
                showLoading(false);
                if (xhr.status === 200) {
                    var data = JSON.parse(xhr.responseText);
                    if (data.success) {
                        updateStatus('upload-status', 'success', 'âœ“ æˆåŠŸ');
                        showResult('upload-result', data);
                    } else {
                        updateStatus('upload-status', 'error', 'âœ— å¤±è´¥');
                        showResult('upload-result', data);
                    }
                } else {
                    updateStatus('upload-status', 'error', 'âœ— å¤±è´¥');
                    showResult('upload-result', { error: 'HTTP ' + xhr.status });
                }
            };
            xhr.onerror = function() {
                showLoading(false);
                updateStatus('upload-status', 'error', 'âœ— å¤±è´¥');
                showResult('upload-result', { error: 'ç½‘ç»œé”™è¯¯' });
            };
            xhr.send(formData);
        }
        
        function testBatchUpload() {
            var fileInput = document.getElementById('upload-batch-files');
            var files = Array.from(fileInput.files);
            if (files.length === 0) {
                showError('è¯·é€‰æ‹©å›¾ç‰‡');
                return;
            }
            
            showLoading(true);
            updateStatus('batch-status', 'pending', 'æµ‹è¯•ä¸­...');
            
            var formData = new FormData();
            files.forEach(function(file) {
                formData.append('files', file);
            });
            
            var xhr = new XMLHttpRequest();
            xhr.open('POST', apiBaseUrl + '/data/batch', true);
            xhr.onload = function() {
                showLoading(false);
                if (xhr.status === 200) {
                    var data = JSON.parse(xhr.responseText);
                    if (data.success) {
                        updateStatus('batch-status', 'success', 'âœ“ æˆåŠŸ');
                        showResult('batch-result', data);
                    } else {
                        updateStatus('batch-status', 'error', 'âœ— å¤±è´¥');
                        showResult('batch-result', data);
                    }
                } else {
                    updateStatus('batch-status', 'error', 'âœ— å¤±è´¥');
                    showResult('batch-result', { error: 'HTTP ' + xhr.status });
                }
            };
            xhr.onerror = function() {
                showLoading(false);
                updateStatus('batch-status', 'error', 'âœ— å¤±è´¥');
                showResult('batch-result', { error: 'ç½‘ç»œé”™è¯¯' });
            };
            xhr.send(formData);
        }
        
        function testQueryAnalysis() {
            var id = document.getElementById('query-analysis-id').value;
            if (!id) {
                showError('è¯·è¾“å…¥è®°å½• ID');
                return;
            }
            
            showLoading(true);
            updateStatus('query-analysis-status', 'pending', 'æµ‹è¯•ä¸­...');
            
            var xhr = new XMLHttpRequest();
            xhr.open('GET', apiBaseUrl + '/data/analysis/' + id, true);
            xhr.onload = function() {
                showLoading(false);
                if (xhr.status === 200) {
                    var data = JSON.parse(xhr.responseText);
                    if (data.success) {
                        updateStatus('query-analysis-status', 'success', 'âœ“ æˆåŠŸ');
                        showResult('query-analysis-result', data);
                    } else {
                        updateStatus('query-analysis-status', 'error', 'âœ— å¤±è´¥');
                        showResult('query-analysis-result', data);
                    }
                } else {
                    updateStatus('query-analysis-status', 'error', 'âœ— å¤±è´¥');
                    showResult('query-analysis-result', { error: 'HTTP ' + xhr.status });
                }
            };
            xhr.onerror = function() {
                showLoading(false);
                updateStatus('query-analysis-status', 'error', 'âœ— å¤±è´¥');
                showResult('query-analysis-result', { error: 'ç½‘ç»œé”™è¯¯' });
            };
            xhr.send();
        }
        
        function testQueryType() {
            var id = document.getElementById('query-type-id').value;
            if (!id) {
                showError('è¯·è¾“å…¥è®°å½• ID');
                return;
            }
            
            showLoading(true);
            updateStatus('query-type-status', 'pending', 'æµ‹è¯•ä¸­...');
            
            var xhr = new XMLHttpRequest();
            xhr.open('GET', apiBaseUrl + '/data/type/' + id, true);
            xhr.onload = function() {
                showLoading(false);
                if (xhr.status === 200) {
                    var data = JSON.parse(xhr.responseText);
                    if (data.success) {
                        updateStatus('query-type-status', 'success', 'âœ“ æˆåŠŸ');
                        showResult('query-type-result', data);
                    } else {
                        updateStatus('query-type-status', 'error', 'âœ— å¤±è´¥');
                        showResult('query-type-result', data);
                    }
                } else {
                    updateStatus('query-type-status', 'error', 'âœ— å¤±è´¥');
                    showResult('query-type-result', { error: 'HTTP ' + xhr.status });
                }
            };
            xhr.onerror = function() {
                showLoading(false);
                updateStatus('query-type-status', 'error', 'âœ— å¤±è´¥');
                showResult('query-type-result', { error: 'ç½‘ç»œé”™è¯¯' });
            };
            xhr.send();
        }
        
        function testSort() {
            var field = document.getElementById('sort-field').value;
            var order = document.getElementById('sort-order').value;
            var limit = document.getElementById('sort-limit').value;
            
            showLoading(true);
            updateStatus('sort-status', 'pending', 'æµ‹è¯•ä¸­...');
            
            var url = apiBaseUrl + '/data/list?field=' + encodeURIComponent(field) + 
                '&order=' + encodeURIComponent(order) + 
                '&limit=' + encodeURIComponent(limit);
            
            var xhr = new XMLHttpRequest();
            xhr.open('GET', url, true);
            xhr.onload = function() {
                showLoading(false);
                if (xhr.status === 200) {
                    var data = JSON.parse(xhr.responseText);
                    if (data.success) {
                        updateStatus('sort-status', 'success', 'âœ“ æˆåŠŸ');
                        showResult('sort-result', data);
                    } else {
                        updateStatus('sort-status', 'error', 'âœ— å¤±è´¥');
                        showResult('sort-result', data);
                    }
                } else {
                    updateStatus('sort-status', 'error', 'âœ— å¤±è´¥');
                    showResult('sort-result', { error: 'HTTP ' + xhr.status });
                }
            };
            xhr.onerror = function() {
                showLoading(false);
                updateStatus('sort-status', 'error', 'âœ— å¤±è´¥');
                showResult('sort-result', { error: 'ç½‘ç»œé”™è¯¯' });
            };
            xhr.send();
        }
        
        function testAllApis() {
            showInfo('å¼€å§‹æµ‹è¯•æ‰€æœ‰æ¥å£...');
            
            setTimeout(function() {
                testPredict();
            }, 100);
            
            setTimeout(function() {
                testAnalyze();
            }, 500);
            
            setTimeout(function() {
                testUpload();
            }, 1000);
            
            setTimeout(function() {
                testBatchUpload();
            }, 1500);
            
            setTimeout(function() {
                testQueryAnalysis();
            }, 2000);
            
            setTimeout(function() {
                testQueryType();
            }, 2500);
            
            setTimeout(function() {
                testSort();
            }, 3000);
        }
        
        function clearAllResults() {
            var statusElements = document.querySelectorAll('.status');
            statusElements.forEach(function(element) {
                element.className = 'status pending';
                element.textContent = 'æœªæµ‹è¯•';
            });
            
            var resultBoxes = document.querySelectorAll('.result-box');
            resultBoxes.forEach(function(element) {
                element.style.display = 'none';
                element.innerHTML = '';
            });
            
            showInfo('å·²æ¸…ç©ºæ‰€æœ‰æµ‹è¯•ç»“æœ');
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            var uploadArea = document.getElementById('upload-area');
            var fileInput = document.getElementById('file-input');
            
            uploadArea.addEventListener('click', function() {
                fileInput.click();
            });
            
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.style.background = '#d4edda';
                document.getElementById('upload-prompt').innerHTML = 
                    '<p style="font-size: 18px; color: #28a745;">ğŸ“¥ é‡Šæ”¾é¼ æ ‡ä¸Šä¼ </p>';
            });
            
            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadArea.style.background = '#f8f9fa';
                document.getElementById('upload-prompt').innerHTML = 
                    '<p style="font-size: 18px; color: #667eea;">ğŸ“ ç‚¹å‡»æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„</p>' +
                    '<p style="color: #6c757d; margin-top: 10px;">æ”¯æŒ JPGã€PNG æ ¼å¼</p>';
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.style.background = '#f8f9fa';
                document.getElementById('upload-prompt').innerHTML = 
                    '<p style="font-size: 18px; color: #667eea;">ğŸ“ ç‚¹å‡»æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„</p>' +
                    '<p style="color: #6c757d; margin-top: 10px;">æ”¯æŒ JPGã€PNG æ ¼å¼</p>';
                
                var files = Array.from(e.dataTransfer.files);
                files.forEach(function(file) {
                    uploadFiles.push({
                        name: file.name,
                        file: file,
                        status: 'pending',
                        statusText: 'ç­‰å¾…ä¸Šä¼ '
                    });
                });
                
                renderFileList();
            });
            
            fileInput.addEventListener('change', function(e) {
                var files = Array.from(e.target.files);
                files.forEach(function(file) {
                    uploadFiles.push({
                        name: file.name,
                        file: file,
                        status: 'pending',
                        statusText: 'ç­‰å¾…ä¸Šä¼ '
                    });
                });
                
                renderFileList();
            });
            
            document.getElementById('upload-btn').addEventListener('click', uploadFiles);
            document.getElementById('clear-btn').addEventListener('click', clearFiles);
            document.getElementById('query-btn').addEventListener('click', fetchData);
            
            fetchData();
        });
    </script>
</body>
</html>
